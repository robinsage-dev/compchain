<div id="sidebar" class="sidebar">



    {{#data:key/"tableHelper"
        /str/"<div class='paginationSection'>
                    <div class='resultLabel'>
                        <span class='paginateLabel'>%label</span>
                        <div class='paginateContainer'><select id='paginate'></select></div>
                    </div>

                </div>"}}

    {{#data:key/"allowSearch"
    /str/"
    <div style='margin-left:12px; margin-top:12px;'>
        <form method='get' id='filterForm' action='/%modelRoute/%searchPath'>
            <i class='fa fa-search' aria-hidden='true'></i>
            <input type='text' class='searchField' name='search' placeholder='Search %name' value='%currentSearchTerm'>
            <div class='advancedFilters'>
            %searchFilters
            <input class='filterSubmit' type='submit' value='Apply Search Filters' />
                </div>
            <div id='filterToggle'>Advanced</div>
        </form>

    </div>"}}



    {{#data:key/"modelViewHelper"
    /str/"<div class='heading'>%modelName %tableHelper</div>"}}

    {{#data:key/"allowedActions.[]"
        /str/"<a class='link %linkClass %active' href='%path'>
                <span class='icon'><i class='%icon'></i></span> %text</a>}}

    {{#data:key/"models"
        /str/"<div class='heading'>
                Manage
            </div>"}}

    {{#data:key/"models.[]"
        /str/"<a class='link %active' href='/%route'><span class='icon'>%icon</span> %name</a>"}}


    <div class="heading">
        Your Profile
    </div>
    {{#data:key/authLink}}

    <div class="versionNum">v. {{#data:key/appVersion}}</div>

    <script type="text/javascript">

        var filterTimeout = null;
        $('#filterForm').find('input').change(function(e){
            submitFilterOnDelay();
        });

        $('#filterForm').find('select').on('change', function(e){
            submitFilterOnDelay();
        });

        console.log('sidebar');
        function submitFilterOnDelay(e)
        {
            $(e).parents('.filterContainer').addClass('on');
            console.log('changed');
            return;

            filterTimeout = null;
            filterTimeout = setTimeout(function(){
                $('#filterForm').submit();
            }, 1000);
        }

        $('#filterToggle').click(function(e){
            if ($('.advancedFilters').is(':visible'))
            {
                $('#filterToggle').text('Advanced');
            }
            else
            {
                $('#filterToggle').text('Hide');
            }

           $('.advancedFilters').slideToggle();
        });

        $('#filterForm').submit(function(e) {
            var checkboxes = $(e.currentTarget).find('input[type="checkbox"]');

            if ($('.searchField').val() == '')
            {
                $('.searchField').attr('disabled', 'disabled');
            }

            $('.filter-daterange').each(function(index, item){
                var key = $(item).attr('key');
                var value = $(item).val();
                if (value == '')
                {
                    $('#'+key+'_gte').attr('disabled', 'disabled');
                    $('#'+key+'_lte').attr('disabled', 'disabled');
                    return;
                }
                var split = value.split(' to ');
                split = split.map(function(date, idx)
                {
                  date = new Date(date);

                  // date.setHours(-date.getUTCHours());
                  if (idx === 1)
                  {
                    date.setHours(23);
                    date.setMinutes(59);
                    date.setSeconds(59);
                    date.setMilliseconds(999);
                  }
                  // console.log('date is after', date);

                  return date.toISOString();
                })
                $('#'+key+'_gte').val(split[0]);
                $('#'+key+'_lte').val(split[1]);
            });

            $.each( checkboxes, function( key, value ) {
                /*if (!$(item).parent().hasClass('on'))
                {
                    $(value).attr('disabled', 'disabled');
                    return;
                }*/
                if (value.checked === false) {
                    value.value = 'false';
                } else {
                    value.value = 'true';
                }
                $(value).attr('type', 'hidden');
            });

            $('.filterContainer').each(function(index, item){
               if (!$(item).hasClass('on'))
               {
                   $(item).find('input').attr('disabled', 'disabled');
                   $(item).find('select').attr('disabled', 'disabled');
               }
            });

            return true;

            // var filterForm = e.target;
            // function submitAdvancedFilter(e)
            // {
            //   console.log('advanced filter this:', this);
            //   console.log('e is:', arguments);
            //   e.preventDefault();
            //
            //   var inputs = filterForm.querySelectorAll('input');
            //   console.log('inputs are', inputs);
            //
            //   var queryparts = [];
            //   Array.prototype.slice.call(inputs).forEach(function(input)
            //   {
            //     var value = input.value;
            //     var key = input.name;
            //     console.log('input is:', input);
            //     if (input.type === 'submit')
            //     {
            //       return;
            //     }
            //     else if (input.type === 'checkbox')
            //     {
            //       value = input.getAttribute('value');
            //       // value = value === 'on' ? 'true' : 'false';
            //     }
            //
            //     queryparts.push(input.name + '=' + encodeURIComponent(input.value));
            //
            //   });
            //
            //   console.log('query is:', queryparts.join('&'));
            //
            //   window.location = filterForm.target + '?' + queryparts.join('&');
            // }
            //
            // submitAdvancedFilter(e);
            //
            // return false;
        });
    </script>

</div>
